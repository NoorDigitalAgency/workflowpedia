name: Release
on:
  workflow_call:
    inputs:
      stage:
        description: Stage
        type: string
        required: true
      commit:
        description: Commit Id
        type: string
        default: ''
      version:
        description: Release Version
        type: string
        required: true
jobs:
  release:
    runs-on: ubuntu-20.04
    name: Release
    steps:
      - id: analyzing
        name: Analyzing
        uses: actions/github-script@v6
        with:
          script: |
            // [{"name":"v0.1"}]
            console.log(JSON.stringify((await github.rest.repos.listTags({
              owner: context.repo.owner,
              repo: context.repo.repo
            })).data))
            // {"name":"v0.9.4","body":"**Full Changelog**: https://github.com/NoorDigitalAgency/lightning-test/compare/v0.9.2...v0.9.4"}
            console.log(JSON.stringify((await github.rest.repos.generateReleaseNotes({
              owner: context.repo.owner,
              repo: context.repo.repo,
              tag_name: 'v0.9.4',
              target_commitish: '${{ github.event.inputs.commit }}',
              previous_tag_name: 'v0.9.2'
            })).data))
            github.rest.repos.createRelease({
              owner: context.repo.owner,
              repo: context.repo.repo,
              tag_name: 'v0.9.2',
              target_commitish: '${{ github.event.inputs.commit }}',
              prerelease: false,
              generate_release_notes: true
            })
            
